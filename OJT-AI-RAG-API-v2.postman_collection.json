{
	"info": {
		"_postman_id": "ojt-ai-rag-collection-v2",
		"name": "OJT-AI RAG API v2",
		"description": "RAG çŸ¥è¯†åº“ API é›†åˆï¼ˆv2 ç‰ˆæœ¬ï¼‰\n\n**æ›´æ–°è¯´æ˜ï¼š**\n- tenantId/kbId ç°åœ¨ä» JWT Token è‡ªåŠ¨è·å–ï¼Œæ— éœ€å®¢æˆ·ç«¯ä¼ å…¥\n- æ·»åŠ äº†è¯·æ±‚ä½“éªŒè¯ï¼ˆquery å¿…å¡«ã€topK èŒƒå›´ 1-100ï¼‰\n- context å­—æ®µç±»å‹ä¿®æ­£ä¸ºæ•°ç»„æ ¼å¼\n\n**æµ‹è¯•é¡ºåºï¼š**\n1. å…ˆæ‰§è¡Œã€Œç™»å½•ã€è·å– Token\n2. å†æ‰§è¡Œå…¶ä»–éœ€è¦è®¤è¯çš„ API",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{jwt_token}}",
				"type": "string"
			}
		]
	},
	"item": [
		{
			"name": "1. å…¬å¼€æ¥å£ï¼ˆæ— éœ€è®¤è¯ï¼‰",
			"item": [
				{
					"name": "å¥åº·æ£€æŸ¥",
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/actuator/health",
							"host": ["{{base_url}}"],
							"path": ["actuator", "health"]
						},
						"description": "Spring Boot Actuator å¥åº·æ£€æŸ¥ç«¯ç‚¹"
					},
					"response": []
				},
				{
					"name": "è·å–ç³»ç»Ÿé…ç½®",
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/public/config",
							"host": ["{{base_url}}"],
							"path": ["api", "public", "config"]
						},
						"description": "è·å–ç³»ç»Ÿå…¬å¼€é…ç½®ä¿¡æ¯"
					},
					"response": []
				}
			]
		},
		{
			"name": "2. è®¤è¯æ¥å£",
			"item": [
				{
					"name": "ç”¨æˆ·æ³¨å†Œ",
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"username\": \"testuser\",\n  \"password\": \"password123\",\n  \"email\": \"test@example.com\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/register",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "register"]
						},
						"description": "æ³¨å†Œæ–°ç”¨æˆ·"
					},
					"response": []
				},
				{
					"name": "ç”¨æˆ·ç™»å½• â­",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// è‡ªåŠ¨ä¿å­˜ Token åˆ°ç¯å¢ƒå˜é‡",
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.code === 200 && jsonData.data && jsonData.data.token) {",
									"        pm.environment.set('jwt_token', jsonData.data.token);",
									"        pm.environment.set('username', jsonData.data.username);",
									"        console.log('âœ… Token å·²ä¿å­˜');",
									"        console.log('âœ… ç”¨æˆ·å:', jsonData.data.username);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"username\": \"admin\",\n  \"password\": \"123456\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/login",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "login"]
						},
						"description": "ç”¨æˆ·ç™»å½•\n\n**é‡è¦ï¼š** ç™»å½•æˆåŠŸå Token ä¼šè‡ªåŠ¨ä¿å­˜åˆ°ç¯å¢ƒå˜é‡ `jwt_token`\n\n**é»˜è®¤è´¦æˆ·ï¼š**\n- admin / 123456"
					},
					"response": []
				},
				{
					"name": "è·å–ç”¨æˆ·ä¿¡æ¯",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/auth/userinfo",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "userinfo"]
						},
						"description": "è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼ˆéœ€è¦è®¤è¯ï¼‰"
					},
					"response": []
				},
				{
					"name": "ç”¨æˆ·ç™»å‡º",
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/auth/logout",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "logout"]
						},
						"description": "ç™»å‡ºå½“å‰ç”¨æˆ·"
					},
					"response": []
				}
			]
		},
		{
			"name": "3. æ–‡ä»¶ä¸Šä¼ ",
			"item": [
				{
					"name": "ä¸Šä¼ æ–‡æ¡£åˆ°çŸ¥è¯†åº“",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "",
									"description": "é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼ˆPDF, TXT, DOC ç­‰ï¼‰"
								},
								{
									"key": "kbId",
									"value": "kb-001",
									"type": "text",
									"description": "çŸ¥è¯†åº“IDï¼ˆå¯é€‰ï¼Œé»˜è®¤ kb-001ï¼‰"
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/file/upload",
							"host": ["{{base_url}}"],
							"path": ["api", "file", "upload"]
						},
						"description": "ä¸Šä¼ æ–‡æ¡£åˆ° RAG çŸ¥è¯†åº“\n\n**è¯´æ˜ï¼š**\n- tenantId è‡ªåŠ¨ä» JWT Token è·å–\n- æ–‡ä»¶ä¸Šä¼ åä¼šå‘é€åˆ° Kafka è¿›è¡Œå¼‚æ­¥å¤„ç†\n- è¿”å› docId ç”¨äºè¿½è¸ªå¤„ç†çŠ¶æ€"
					},
					"response": []
				}
			]
		},
		{
			"name": "4. RAG æœç´¢",
			"item": [
				{
					"name": "å‘é‡æœç´¢",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.data && jsonData.data.requestId) {",
									"        pm.environment.set('last_request_id', jsonData.data.requestId);",
									"        console.log('âœ… RequestId å·²ä¿å­˜:', jsonData.data.requestId);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"query\": \"Spring WebFlux æ˜¯ä»€ä¹ˆï¼Ÿ\",\n  \"topK\": 5\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/rag/search",
							"host": ["{{base_url}}"],
							"path": ["api", "rag", "search"]
						},
						"description": "å‘é‡æœç´¢æ–‡æ¡£\n\n**å‚æ•°è¯´æ˜ï¼š**\n- `query`: æœç´¢æŸ¥è¯¢ï¼ˆå¿…å¡«ï¼Œæœ€å¤§2000å­—ç¬¦ï¼‰\n- `topK`: è¿”å›ç»“æœæ•°é‡ï¼ˆ1-100ï¼Œé»˜è®¤5ï¼‰\n\n**æ³¨æ„ï¼š** tenantId/kbId ä» JWT è‡ªåŠ¨è·å–ï¼Œæ— éœ€ä¼ å…¥\n\n**è¿”å›ï¼š** requestId ç”¨äºè½®è¯¢ç»“æœ"
					},
					"response": []
				},
				{
					"name": "è·å–æœç´¢ç»“æœ",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/rag/result/{{last_request_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "rag", "result", "{{last_request_id}}"]
						},
						"description": "è½®è¯¢è·å–æœç´¢ç»“æœ\n\n**è¯´æ˜ï¼š**\n- å¦‚æœç»“æœæœªå°±ç»ªï¼Œè¿”å› 404\n- RAG Worker å¤„ç†å®Œæˆåå¯è·å–ç»“æœ\n- ç»“æœå­˜å‚¨åœ¨ Redisï¼Œ10åˆ†é’Ÿè¿‡æœŸ"
					},
					"response": []
				}
			]
		},
		{
			"name": "5. RAG ç­”æ¡ˆç”Ÿæˆ",
			"item": [
				{
					"name": "ç”Ÿæˆç­”æ¡ˆï¼ˆæ–°ä¼šè¯ï¼‰",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ç”Ÿæˆæ–°çš„ SessionId",
									"const sessionId = 'session-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);",
									"pm.environment.set('current_session_id', sessionId);",
									"console.log('ğŸ†• æ–° SessionId:', sessionId);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.data) {",
									"        if (jsonData.data.requestId) {",
									"            pm.environment.set('last_request_id', jsonData.data.requestId);",
									"            console.log('âœ… RequestId:', jsonData.data.requestId);",
									"        }",
									"        if (jsonData.data.sessionId) {",
									"            pm.environment.set('current_session_id', jsonData.data.sessionId);",
									"            console.log('âœ… SessionId:', jsonData.data.sessionId);",
									"        }",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"question\": \"ä»€ä¹ˆæ˜¯ Spring WebFluxï¼Ÿè¯·è¯¦ç»†è§£é‡Šå®ƒçš„å·¥ä½œåŸç†ã€‚\",\n  \"context\": [\n    {\n      \"text\": \"Spring WebFlux æ˜¯ Spring 5 å¼•å…¥çš„å“åº”å¼ Web æ¡†æ¶ã€‚\",\n      \"source\": \"spring-docs\",\n      \"score\": 0.95\n    }\n  ]\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/rag/answer",
							"host": ["{{base_url}}"],
							"path": ["api", "rag", "answer"]
						},
						"description": "ç”Ÿæˆ RAG ç­”æ¡ˆï¼ˆåˆ›å»ºæ–°ä¼šè¯ï¼‰\n\n**å‚æ•°è¯´æ˜ï¼š**\n- `question`: é—®é¢˜ï¼ˆå¿…å¡«ï¼Œæœ€å¤§5000å­—ç¬¦ï¼‰\n- `context`: ä¸Šä¸‹æ–‡æ•°ç»„ï¼ˆå¿…å¡«ï¼Œæ¥è‡ªæœç´¢ç»“æœï¼‰\n- `sessionId`: ä¼šè¯IDï¼ˆå¯é€‰ï¼Œä¸ä¼ åˆ™åˆ›å»ºæ–°ä¼šè¯ï¼‰\n\n**æ³¨æ„ï¼š** tenantId ä» JWT è‡ªåŠ¨è·å–\n\n**è¿”å›ï¼š** requestId å’Œ sessionId"
					},
					"response": []
				},
				{
					"name": "ç”Ÿæˆç­”æ¡ˆï¼ˆç»§ç»­å¯¹è¯ï¼‰",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.data && jsonData.data.requestId) {",
									"        pm.environment.set('last_request_id', jsonData.data.requestId);",
									"        console.log('âœ… RequestId:', jsonData.data.requestId);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"question\": \"å®ƒå’Œä¼ ç»Ÿçš„ Spring MVC æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\",\n  \"sessionId\": \"{{current_session_id}}\",\n  \"context\": [\n    {\n      \"text\": \"Spring MVC åŸºäº Servlet APIï¼Œä½¿ç”¨é˜»å¡ I/Oã€‚\",\n      \"source\": \"spring-docs\",\n      \"score\": 0.90\n    }\n  ]\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/rag/answer",
							"host": ["{{base_url}}"],
							"path": ["api", "rag", "answer"]
						},
						"description": "ç»§ç»­å¤šè½®å¯¹è¯\n\n**è¯´æ˜ï¼š**\n- ä½¿ç”¨ç›¸åŒçš„ sessionId ä¿æŒå¯¹è¯ä¸Šä¸‹æ–‡\n- ç³»ç»Ÿä¼šè‡ªåŠ¨åŠ è½½å†å²å¯¹è¯ï¼ˆæœ€è¿‘10æ¡ï¼‰\n- å¯ä»¥ä½¿ç”¨ä»£è¯å¼•ç”¨ä¹‹å‰çš„å†…å®¹"
					},
					"response": []
				},
				{
					"name": "è·å–ç­”æ¡ˆç»“æœ",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/rag/result/{{last_request_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "rag", "result", "{{last_request_id}}"]
						},
						"description": "è½®è¯¢è·å–ç­”æ¡ˆç»“æœ\n\n**è¯´æ˜ï¼š**\n- RAG Worker å¤„ç†å®Œæˆåè¿”å›ç­”æ¡ˆ\n- ç»“æœå­˜å‚¨åœ¨ Redisï¼Œ10åˆ†é’Ÿè¿‡æœŸ\n- 404 è¡¨ç¤ºç»“æœæœªå°±ç»ª"
					},
					"response": []
				}
			]
		},
		{
			"name": "6. æœç´¢+ç­”æ¡ˆç»„åˆ",
			"item": [
				{
					"name": "æœç´¢å¹¶ç”Ÿæˆç­”æ¡ˆ",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.data && jsonData.data.search_request_id) {",
									"        pm.environment.set('last_request_id', jsonData.data.search_request_id);",
									"        console.log('âœ… Search RequestId:', jsonData.data.search_request_id);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"query\": \"å¦‚ä½•ä½¿ç”¨ Spring WebFlux æ„å»ºå“åº”å¼åº”ç”¨ï¼Ÿ\",\n  \"topK\": 5\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/rag/search-and-answer",
							"host": ["{{base_url}}"],
							"path": ["api", "rag", "search-and-answer"]
						},
						"description": "ç»„åˆæ¥å£ï¼šå…ˆæœç´¢å†ç”Ÿæˆç­”æ¡ˆ\n\n**æµç¨‹ï¼š**\n1. å‘é€æœç´¢è¯·æ±‚\n2. è·å– search_request_id\n3. è½®è¯¢æœç´¢ç»“æœ\n4. ä½¿ç”¨æœç´¢ç»“æœè°ƒç”¨ /answer æ¥å£"
					},
					"response": []
				}
			]
		},
		{
			"name": "7. WebSocket è¯´æ˜",
			"item": [
				{
					"name": "WebSocket è¿æ¥ä¿¡æ¯",
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "ws://localhost:8080/ws/chat?sessionId={{current_session_id}}",
							"protocol": "ws",
							"host": ["localhost"],
							"port": "8080",
							"path": ["ws", "chat"],
							"query": [
								{
									"key": "sessionId",
									"value": "{{current_session_id}}"
								}
							]
						},
						"description": "WebSocket å®æ—¶æ¨é€\n\n**è¿æ¥åœ°å€ï¼š**\n```\nws://localhost:8080/ws/chat?sessionId={your-session-id}\n```\n\n**åŠŸèƒ½ï¼š**\n- æ— éœ€è®¤è¯\n- RAG Worker å¤„ç†å®Œæˆåè‡ªåŠ¨æ¨é€ç»“æœ\n- æ¯”è½®è¯¢æ›´é«˜æ•ˆ\n\n**æµ‹è¯•å·¥å…·ï¼š**\n- æµè§ˆå™¨æ‰©å±•: Simple WebSocket Client\n- å‘½ä»¤è¡Œ: wscat -c \"ws://localhost:8080/ws/chat?sessionId=xxx\"\n\n**æ³¨æ„ï¼š** Postman ä¸æ”¯æŒ WebSocket æµ‹è¯•ï¼Œè¯·ä½¿ç”¨å…¶ä»–å·¥å…·"
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// å…¨å±€é¢„è¯·æ±‚è„šæœ¬",
					"console.log('ğŸš€ è¯·æ±‚:', pm.info.requestName);"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// å…¨å±€æµ‹è¯•è„šæœ¬",
					"console.log('ğŸ“¥ å“åº”çŠ¶æ€:', pm.response.code);",
					"",
					"// æ£€æŸ¥é€šç”¨é”™è¯¯",
					"if (pm.response.code === 401) {",
					"    console.log('âš ï¸ è®¤è¯å¤±è´¥ï¼Œè¯·å…ˆæ‰§è¡Œã€Œç™»å½•ã€æ¥å£');",
					"}",
					"if (pm.response.code === 400) {",
					"    console.log('âš ï¸ è¯·æ±‚å‚æ•°é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¯·æ±‚ä½“');",
					"}"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8080",
			"type": "string"
		}
	]
}
